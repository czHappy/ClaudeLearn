# 实验：结构体 - 学生信息管理系统

## 实验信息

| 项目 | 内容 |
|------|------|
| 实验名称 | 结构体 - 学生信息管理系统 |
| 实验目的 | 掌握结构体的定义、初始化、成员访问、数组、嵌套、函数传参及内存对齐 |
| 预计时间 | 90 分钟 |
| 难度级别 | 中级 |

---

## 一、实验目的

通过本实验，学生应掌握以下知识点：

1. **struct 定义与初始化**：理解结构体的声明方式和多种初始化方法
2. **成员访问**：熟练使用 `.` 和 `->` 运算符访问结构体成员
3. **结构体数组**：掌握结构体数组的定义和遍历操作
4. **结构体嵌套**：理解结构体中包含其他结构体的设计方法
5. **结构体与函数**：掌握结构体作为函数参数和返回值的使用
6. **内存对齐与 sizeof**：理解结构体的内存布局和对齐规则
7. **const 引用传递**：掌握高效且安全的结构体参数传递方式

---

## 二、背景知识

### 2.1 结构体概述

结构体（struct）是 C++ 中一种用户自定义的数据类型，它允许将不同类型的数据组合在一起形成一个整体。结构体是面向对象编程的基础，是从基本数据类型向复杂数据结构过渡的重要概念。

### 2.2 结构体定义语法

```cpp
struct 结构体名 {
    数据类型 成员名1;
    数据类型 成员名2;
    // ...
};
```

### 2.3 初始化方式

```cpp
// 方式1：声明后逐个赋值
Student s1;
s1.id = 1001;
s1.name = "张三";

// 方式2：聚合初始化（C++11）
Student s2 = {1002, "李四", 20};

// 方式3：指定成员初始化（C++20）
Student s3 = {.id = 1003, .name = "王五", .age = 21};

// 方式4：使用构造函数（如果定义了）
Student s4(1004, "赵六", 22);
```

### 2.4 成员访问运算符

| 运算符 | 使用场景 | 示例 |
|--------|----------|------|
| `.` | 通过对象访问成员 | `student.name` |
| `->` | 通过指针访问成员 | `pStudent->name` |

### 2.5 内存对齐规则

结构体的内存对齐遵循以下规则：
1. 结构体成员的偏移量必须是该成员大小的整数倍
2. 结构体的总大小必须是最大成员大小的整数倍
3. 可以使用 `#pragma pack` 修改对齐方式

```cpp
struct Example1 {
    char a;    // 1 字节
    int b;     // 4 字节
    char c;    // 1 字节
};  // sizeof = 12（非 6）

struct Example2 {
    char a;    // 1 字节
    char c;    // 1 字节
    int b;     // 4 字节
};  // sizeof = 8（优化后）
```

### 2.6 const 引用传递

```cpp
// 值传递：会复制整个结构体（效率低）
void printStudent(Student s);

// 指针传递：高效，但可能修改原数据
void printStudent(Student* s);

// const 引用传递：高效且安全（推荐）
void printStudent(const Student& s);
```

---

## 三、实验环境

- **操作系统**：Windows 10/11
- **编译器**：g++ 8.0 或更高版本，支持 C++11 标准
- **IDE**：Visual Studio Code / Visual Studio / Dev-C++

### 编译命令

```bash
g++ -std=c++11 -o submit submit.cpp
./submit
```

---

## 四、实验内容

### 场景描述

你需要为某高校设计一个学生信息管理系统。系统需要管理学生的基本信息、课程信息以及学生的选课情况。通过这个系统，可以实现学生信息的录入、查询、修改和统计等功能。

### 任务清单

#### 任务 1：定义 Student 结构体（10 分）

定义一个表示学生基本信息的结构体，包含以下成员：
- 学号（id）：整型
- 姓名（name）：string 类型
- 年龄（age）：整型
- 性别（gender）：字符型（'M' 或 'F'）
- GPA（gpa）：浮点型

**要求**：
- 使用标准的结构体定义语法
- 成员变量命名规范

#### 任务 2：定义 Course 结构体（10 分）

定义一个表示课程信息的结构体，包含以下成员：
- 课程编号（courseId）：string 类型
- 课程名称（courseName）：string 类型
- 学分（credits）：整型
- 课时（hours）：整型

#### 任务 3：定义 Enrollment 结构体（结构体嵌套）（15 分）

定义一个表示学生选课信息的结构体，包含：
- 学生信息（student）：Student 类型（嵌套结构体）
- 所选课程（course）：Course 类型（嵌套结构体）
- 成绩（score）：浮点型

**要求**：
- 正确使用结构体嵌套
- 理解嵌套结构体的内存布局

#### 任务 4：创建并初始化结构体数组（15 分）

在 main 函数中：
1. 创建一个包含 5 个学生的 Student 数组
2. 使用聚合初始化方式初始化数组
3. 遍历并输出所有学生信息

**示例输出格式**：
```
学号: 1001, 姓名: 张三, 年龄: 20, 性别: M, GPA: 3.85
学号: 1002, 姓名: 李四, 年龄: 21, 性别: F, GPA: 3.72
...
```

#### 任务 5：实现 printStudent 函数（const 引用传递）（10 分）

实现一个打印学生信息的函数：
```cpp
void printStudent(const Student& s);
```

**要求**：
- 使用 const 引用作为参数
- 格式化输出学生的所有信息

#### 任务 6：实现 updateStudentAge 函数（引用传递修改）（10 分）

实现一个修改学生年龄的函数：
```cpp
void updateStudentAge(Student& s, int newAge);
```

**要求**：
- 使用非 const 引用以便修改原数据
- 修改学生的年龄为新值

#### 任务 7：实现 findStudentById 函数（返回结构体）（15 分）

实现一个根据学号查找学生的函数：
```cpp
Student* findStudentById(Student students[], int size, int id);
```

**要求**：
- 遍历数组查找匹配的学号
- 找到返回指向该学生的指针
- 未找到返回 nullptr

#### 任务 8：观察内存对齐（15 分）

定义以下两个结构体，观察内存对齐的影响：

```cpp
struct AlignTest1 {
    char a;
    int b;
    char c;
    double d;
};

struct AlignTest2 {
    double d;
    int b;
    char a;
    char c;
};
```

**要求**：
- 使用 sizeof 输出两个结构体的大小
- 分析为什么大小不同
- 在代码注释中解释内存布局

---

## 五、测试用例

### 测试 1：结构体初始化和打印

```cpp
Student s = {1001, "张三", 20, 'M', 3.85};
printStudent(s);
```

**预期输出**：
```
学号: 1001, 姓名: 张三, 年龄: 20, 性别: M, GPA: 3.85
```

### 测试 2：修改学生信息

```cpp
Student s = {1001, "张三", 20, 'M', 3.85};
updateStudentAge(s, 21);
printStudent(s);
```

**预期输出**：
```
学号: 1001, 姓名: 张三, 年龄: 21, 性别: M, GPA: 3.85
```

### 测试 3：查找学生

```cpp
Student* found = findStudentById(students, 5, 1003);
if (found != nullptr) {
    cout << "找到学生: " << found->name << endl;
}
```

### 测试 4：内存对齐

```cpp
cout << "AlignTest1 大小: " << sizeof(AlignTest1) << " 字节" << endl;
cout << "AlignTest2 大小: " << sizeof(AlignTest2) << " 字节" << endl;
```

**预期输出**（可能因编译器不同而异）：
```
AlignTest1 大小: 24 字节
AlignTest2 大小: 16 字节
```

---

## 六、提交要求

1. 完成 `submit.cpp` 中所有标记 `// TODO` 的代码
2. 确保程序能够正确编译和运行
3. 代码格式规范，有适当的注释
4. 在内存对齐任务中添加分析注释

---

## 七、评分标准

| 任务 | 分值 | 评分要点 |
|------|------|----------|
| 任务 1 | 10 分 | Student 结构体定义正确 |
| 任务 2 | 10 分 | Course 结构体定义正确 |
| 任务 3 | 15 分 | 结构体嵌套正确，理解内存布局 |
| 任务 4 | 15 分 | 数组初始化正确，遍历输出正确 |
| 任务 5 | 10 分 | const 引用传递正确，输出格式正确 |
| 任务 6 | 10 分 | 引用传递修改正确 |
| 任务 7 | 15 分 | 查找逻辑正确，返回值处理正确 |
| 任务 8 | 15 分 | 内存对齐观察正确，分析合理 |
| **总计** | **100 分** | |

---

## 八、常见问题

### Q1：为什么要使用 const 引用传递结构体？

**答**：使用 const 引用传递有两个好处：
1. **效率**：避免复制整个结构体，特别是当结构体较大时
2. **安全**：const 保证函数不会意外修改原数据

### Q2：什么时候用 `.`，什么时候用 `->`？

**答**：
- 当操作的是结构体对象时，使用 `.`
- 当操作的是结构体指针时，使用 `->`
- `ptr->member` 等价于 `(*ptr).member`

### Q3：为什么调整成员顺序会影响结构体大小？

**答**：由于内存对齐的要求，编译器会在成员之间插入填充字节（padding）。合理安排成员顺序（通常按大小从大到小排列）可以减少填充，从而减小结构体的总大小。

### Q4：结构体数组和普通数组有什么区别？

**答**：没有本质区别，只是数组元素的类型是结构体。访问方式相同：`array[i].member`。

---

## 九、扩展思考

1. 如果需要对学生按 GPA 排序，应该如何实现？
2. 如何使用结构体实现一个简单的链表？
3. C++ 中 struct 和 class 有什么区别？
4. 如何使用 `#pragma pack` 强制指定对齐方式？

---

## 十、参考资料

1. C++ Primer（第 5 版）- 第 7 章：类
2. [cppreference - Struct](https://en.cppreference.com/w/cpp/language/struct)
3. [内存对齐详解](https://en.cppreference.com/w/cpp/language/object#Alignment)
