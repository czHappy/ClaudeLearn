# 《继承和多态》课程提纲（C++ 版本）

## 课程信息
- **课程主题**：面向对象编程 - 继承和多态
- **前置知识**：C++ 类和对象、封装、指针基础
- **课程时长**：90分钟
- **编程语言**：C++

---

## 一、场景导入：游戏武器系统（15分钟）

### 1.1 需求描述
> "我们要开发一个 RPG 游戏的武器系统。游戏中有多种武器：剑（Sword）、弓（Bow）、魔杖（Staff）。每种武器都需要：显示信息、攻击敌人、升级强化。"

### 1.2 初步实现（暴露问题）
- 展示"笨办法"：为每种武器写独立的类
- 代码示例：三个独立的武器类，大量重复代码
```cpp
class Sword {
    string name;
    int damage;
    int level;
    void showInfo() { /* 重复代码 */ }
    void upgrade() { /* 重复代码 */ }
    void attack() { cout << "挥砍攻击！"; }
};

class Bow {
    string name;  // 重复
    int damage;   // 重复
    int level;    // 重复
    void showInfo() { /* 重复代码 */ }
    void upgrade() { /* 重复代码 */ }
    void attack() { cout << "射箭攻击！"; }
};

// Staff 类也是类似的重复...
```

- **引导思考**：
  - 这些类有什么共同点？
  - 如果要新增 50 种武器，怎么办？
  - 有没有办法减少重复代码？

### 1.3 引出继承的必要性
- 问题总结：代码重复、维护困难、扩展麻烦
- 解决方案预告：继承

---

## 二、知识点一：继承（25分钟）

### 2.1 什么是继承？
- 定义：子类自动获得父类的属性和方法
- 类比：孩子继承父母的基因
- 术语：基类（Base Class）、派生类（Derived Class）

### 2.2 继承的语法
```cpp
class 基类 {
    // ...
};

class 派生类 : public 基类 {
    // ...
};
```

### 2.3 代码小例子①：简单继承
```cpp
// 基类
class Animal {
protected:
    string name;
public:
    Animal(string n) : name(n) {}

    void eat() {
        cout << name << "正在吃东西" << endl;
    }
};

// 派生类
class Dog : public Animal {
public:
    Dog(string n) : Animal(n) {}
};

// 使用
int main() {
    Dog dog("旺财");
    dog.eat();  // 输出：旺财正在吃东西
    return 0;
}
```

### 2.4 代码小例子②：子类扩展新功能
```cpp
class Dog : public Animal {
public:
    Dog(string n) : Animal(n) {}

    void bark() {
        cout << name << "汪汪叫！" << endl;
    }
};

// 使用
Dog dog("旺财");
dog.eat();   // 继承的方法
dog.bark();  // 新增的方法
```

### 2.5 代码小例子③：方法重写（Override）
```cpp
class Cat : public Animal {
public:
    Cat(string n) : Animal(n) {}

    void eat() {  // 重写基类方法
        cout << name << "优雅地吃猫粮" << endl;
    }
};

// 使用
Cat cat("咪咪");
cat.eat();  // 输出：咪咪优雅地吃猫粮
```

### 2.6 代码小例子④：调用基类构造函数和方法
```cpp
class Bird : public Animal {
    bool canFly;
public:
    Bird(string n, bool fly) : Animal(n), canFly(fly) {}

    void eat() {
        Animal::eat();  // 调用基类方法
        cout << "吃完后整理羽毛" << endl;
    }
};

// 使用
Bird bird("小黄", true);
bird.eat();
// 输出：
// 小黄正在吃东西
// 吃完后整理羽毛
```

### 2.7 回到武器场景：用继承重构
- 设计 Weapon 基类（公共属性和方法）
- 设计 Sword、Bow、Staff 派生类（继承 + 扩展）
- 展示代码复用的效果

---

## 三、知识点二：多态（25分钟）

### 3.1 新的问题引入
> "游戏角色可以装备任意武器，需要一个统一的攻击系统，不管装备什么武器，都能正确执行攻击。"

- 展示问题代码：大量的 if-else 判断
```cpp
void characterAttack(string weaponType) {
    if (weaponType == "sword") {
        // 剑的攻击逻辑
    } else if (weaponType == "bow") {
        // 弓的攻击逻辑
    } else if (weaponType == "staff") {
        // 魔杖的攻击逻辑
    }
    // 每新增一种武器，就要改这里...
}
```

### 3.2 什么是多态？
- 定义：同一个方法，不同对象调用，产生不同的行为
- 口诀："同一接口，不同实现"
- C++ 实现：虚函数（virtual）+ 基类指针
- 类比：同样是"叫"，狗会汪汪，猫会喵喵

### 3.3 代码小例子①：多态基础
```cpp
class Animal {
public:
    virtual void speak() {  // 虚函数！
        cout << "动物在叫" << endl;
    }
};

class Dog : public Animal {
public:
    void speak() override {  // 重写虚函数
        cout << "汪汪汪！" << endl;
    }
};

class Cat : public Animal {
public:
    void speak() override {
        cout << "喵喵喵！" << endl;
    }
};

// 多态的体现
void makeSound(Animal* animal) {
    animal->speak();  // 同样的调用，不同的结果
}

int main() {
    Dog dog;
    Cat cat;

    makeSound(&dog);  // 输出：汪汪汪！
    makeSound(&cat);  // 输出：喵喵喵！

    return 0;
}
```

### 3.4 代码小例子②：多态与数组
```cpp
int main() {
    Animal* animals[4];
    animals[0] = new Dog();
    animals[1] = new Cat();
    animals[2] = new Dog();
    animals[3] = new Cat();

    for(int i = 0; i < 4; i++) {
        animals[i]->speak();  // 自动调用正确的方法
    }

    // 释放内存
    for(int i = 0; i < 4; i++) {
        delete animals[i];
    }

    return 0;
}
```

### 3.5 代码小例子③：多态的扩展性
```cpp
// 新增一种动物，无需修改 makeSound 函数
class Duck : public Animal {
public:
    void speak() override {
        cout << "嘎嘎嘎！" << endl;
    }
};

Duck duck;
makeSound(&duck);  // 直接可用！
```

### 3.6 虚析构函数的重要性
```cpp
class Animal {
public:
    virtual ~Animal() {  // 虚析构函数！
        cout << "Animal析构" << endl;
    }
    virtual void speak() = 0;  // 纯虚函数（抽象类）
};
```

### 3.7 回到武器场景：用多态重构攻击系统
```cpp
void characterAttack(Weapon* weapon) {
    weapon->attack();  // 一行代码搞定所有武器
}

// 使用
Sword* sword = new Sword("屠龙刀", 100);
Bow* bow = new Bow("追风弓", 80);

characterAttack(sword);  // 自动调用剑的攻击
characterAttack(bow);    // 自动调用弓的攻击
```

### 3.8 多态的优势总结
- 开闭原则：对扩展开放，对修改关闭
- 代码简洁：消除 if-else 判断
- 易于扩展：新增武器无需修改现有代码

---

## 四、场景完成：完整的武器系统（10分钟）

### 4.1 完整代码展示
- Weapon 基类（公共属性、虚函数）
- Sword、Bow、Staff 派生类（各自实现）
- 统一的攻击接口（多态应用）

### 4.2 对比总结
| 对比项 | 重构前 | 重构后 |
|-------|-------|-------|
| 代码重复 | 大量重复 | 几乎无重复 |
| 新增武器 | 修改多处 | 只需新增类 |
| 维护难度 | 高 | 低 |

---

## 五、综合实践：魔法学院战斗竞技场（15分钟讲解 + 学生完成）

### 5.1 项目背景故事
> **霍格沃兹魔法学院年度大战**
>
> 在魔法学院的竞技场上，来自三大学派的学生将进行史诗级对决：
> - 🗡️ **战士学派（Warrior）**：身披重甲，使用怒气释放毁灭性攻击
> - 🔮 **法师学派（Mage）**：操控元素魔法，消耗魔力释放强大法术
> - 🏹 **游侠学派（Archer）**：远程狙击，箭矢用尽前可造成持续伤害
> - 🩸 **刺客学派（Assassin）**：隐身暗杀，暴击致命（新增挑战）
>
> 每位学生都有独特的战斗风格和特殊技能。竞技场记录每场战斗的精彩瞬间！

### 5.2 学生任务清单

#### **任务一：设计基类 Character（魔法学生基类）**

**必需属性：**
- `string name` - 角色名字
- `int hp` - 生命值（初始100）
- `int maxHp` - 最大生命值
- `int attackPower` - 基础攻击力
- `string school` - 学派名称（"战士"/"法师"/"游侠"）

**必需方法：**
- `Character(string name, int hp, int attack, string school)` - 构造函数
- `virtual void attack(Character* target)` - 攻击方法（纯虚函数）
- `void takeDamage(int damage)` - 受伤方法
- `bool isAlive()` - 判断是否存活
- `void showStatus()` - 显示状态（生命值条）
- `virtual void showSkillInfo()` - 显示技能信息
- `virtual ~Character()` - 虚析构函数

#### **任务二：战士学派 Warrior（狂暴战士）**

**特色机制：怒气系统**
- 新增属性：`int rage` - 怒气值（0-100）
- 攻击时积累怒气：每次攻击 +20 怒气
- 怒气满（100）时触发狂暴：下次攻击造成 **3倍伤害** + 震屏效果
- 攻击文案："[战士] 挥舞巨剑，造成 X 点物理伤害！"
- 狂暴文案："💥 [狂暴打击] 怒气爆发！造成 X 点毁灭性伤害！"

#### **任务三：法师学派 Mage（元素法师）**

**特色机制：魔法系统**
- 新增属性：`int mp` - 魔法值（初始100）
- 普通攻击：消耗 20 MP，造成 1.5倍伤害
- 魔力不足：只能使用法杖攻击（0.5倍伤害）
- 每回合结束恢复 10 MP
- 攻击文案："✨ [法师] 释放火球术，造成 X 点魔法伤害！"
- 无魔文案："[法师] 魔力耗尽，用法杖敲击，造成 X 点伤害..."

#### **任务四：游侠学派 Archer（精准射手）**

**特色机制：箭矢系统**
- 新增属性：`int arrows` - 箭矢数量（初始10）
- 有箭：造成正常伤害，30% 几率连射两箭（双倍伤害）
- 无箭：使用匕首近战（0.3倍伤害）
- 攻击文案："🏹 [游侠] 精准射击，造成 X 点伤害！"
- 连射文案："🎯 [连珠箭] 快速连射！造成 X 点伤害！"
- 无箭文案："[游侠] 箭矢用尽，匕首攻击，造成 X 点伤害..."

#### **任务五：刺客学派 Assassin（暗影杀手）**（挑战任务）

**特色机制：隐身暗杀**
- 新增属性：`int energy` - 能量值（初始50）
- 消耗 30 能量隐身：下次攻击必定暴击（5倍伤害）
- 普通攻击：50% 几率暴击（2倍伤害）
- 每回合恢复 15 能量
- 攻击文案："🗡️ [刺客] 利刃攻击，造成 X 点伤害！"
- 暴击文案："⚡ [暴击] 致命一击！造成 X 点伤害！"
- 暗杀文案："💀 [暗影暗杀] 从阴影中突袭！造成 X 点致命伤害！！！"

#### **任务六：竞技场系统 Arena（战斗管理）**

**核心功能：**
```cpp
class Arena {
public:
    void battle(Character* fighter1, Character* fighter2);
    // 利用多态实现战斗
    // 回合制战斗，直到一方死亡
    // 每回合显示战斗过程
private:
    void showBattleHeader(Character* f1, Character* f2);
    void showRound(int roundNum);
    void showWinner(Character* winner);
};
```

**战斗流程：**
1. 显示战斗开始信息
2. 显示双方初始状态
3. 回合制战斗：
   - 显示回合数
   - fighter1 攻击 fighter2
   - 显示双方状态
   - fighter2 反击（如果存活）
   - 显示双方状态
   - 判断胜负
4. 显示战斗结果和统计

**美化输出要求：**
- 使用分隔线（====）
- 生命值用进度条表示：`[████████░░] 80/100`
- 不同事件用不同颜色标记（可选）
- 关键时刻添加特效文字

#### **任务七：测试系统（主函数）**

**测试要求：**
1. 创建至少 4 种角色各一个
2. 进行至少 3 场战斗：
   - 战士 vs 法师
   - 游侠 vs 刺客
   - 获胜者 vs 另一场获胜者
3. 展示多态的效果（父类指针数组）
4. 正确释放内存

### 5.3 知识点覆盖检查表

- ✅ 继承：所有角色继承自 Character
- ✅ 构造函数继承：子类调用父类构造函数
- ✅ 虚函数：attack() 为虚函数
- ✅ 纯虚函数：Character 可设为抽象类
- ✅ 方法重写：每个子类重写 attack()
- ✅ 多态：Arena 使用父类指针
- ✅ 虚析构函数：正确释放内存
- ✅ 访问控制：protected 属性
- ✅ 子类扩展：各自的特色属性
- ✅ 调用父类方法：takeDamage(), showStatus()

### 5.4 参考答案（教师用）
- 完整代码实现（约 300 行）
- 详细注释
- 输出效果示例
- 常见错误提示
- 扩展建议

---

## 六、知识总结（5分钟）

### 6.1 继承核心要点
- 语法：`class Derived : public Base`
- 子类自动获得父类的 public 和 protected 成员
- 构造函数调用：`: Base(args)`
- 访问控制：public、protected、private
- 方法重写：子类可以覆盖父类方法

### 6.2 多态核心要点
- **虚函数**：`virtual` 关键字
- **纯虚函数**：`virtual void func() = 0;`（抽象类）
- **虚析构函数**：`virtual ~Base()`（必须！）
- **override 关键字**：明确表示重写
- **父类指针**：`Base* ptr = new Derived()`
- 动态绑定：运行时确定调用哪个版本

### 6.3 C++ 特有要点
- 使用指针或引用才能实现多态
- 必须使用虚析构函数避免内存泄漏
- 注意内存管理（new/delete）
- 可以使用智能指针（unique_ptr、shared_ptr）

---

## 课件文件清单

| 文件名 | 内容 |
|-------|------|
| 01-继承和多态-课件.md | 完整课件（含理论和示例）|
| 02-代码示例.cpp | 所有代码小例子（可独立编译）|
| 03-武器系统完整代码.cpp | 武器场景完整实现 |
| 04-综合实践-任务说明.md | 战斗系统详细任务（学生版）|
| 05-综合实践-参考答案.cpp | 战斗系统完整代码（教师版）|

---

## 教学流程图

```
场景导入（武器系统，暴露问题）
       ↓
   引出继承
       ↓
知识点 + 4个C++代码小例子
       ↓
  用继承重构武器系统
       ↓
   新问题（武器攻击判断）
       ↓
   引出多态和虚函数
       ↓
知识点 + 3个多态代码小例子
       ↓
  用多态重构攻击系统
       ↓
  完整武器系统展示
       ↓
  魔法学院战斗系统（学生实践）
       ↓
    知识总结
```

---

## 教学亮点

- 🎮 **游戏化场景**：武器系统 → 战斗竞技场
- 📖 **故事化设定**：魔法学院、学派对决
- 🎯 **层层递进**：从简单继承到复杂多态
- 💡 **问题驱动**：先暴露问题，再引入解决方案
- 🔧 **实战导向**：300行综合项目，真实开发体验
- ✨ **趣味性**：特效文字、技能文案、战斗场景
