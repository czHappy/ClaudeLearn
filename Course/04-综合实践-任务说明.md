# 综合实践：魔法学院战斗竞技场

> **项目背景**
>
> 在霍格沃兹魔法学院，一年一度的竞技大赛即将开始！来自四大学派的学生将在竞技场上展开史诗级对决。你的任务是实现一个完整的战斗系统，让不同学派的学生能够进行回合制战斗。

---

## 📖 项目目标

通过本项目，你将：
- ✅ 掌握类的继承机制
- ✅ 理解多态的实际应用
- ✅ 学会使用虚函数和纯虚函数
- ✅ 实践面向对象设计
- ✅ 完成一个300行的完整项目

---

## 🎯 项目需求

### 1. 四大学派角色

#### 🗡️ 战士学派（Warrior）
**特色：狂暴战士**
- **怒气系统**：每次攻击积累20点怒气（0-100）
- **普通攻击**：造成基础伤害
- **狂暴打击**：怒气满100时，下次攻击造成3倍伤害并清空怒气
- **攻击文案**：
  - 普通："[战士] 挥舞巨剑，造成 X 点物理伤害！"
  - 狂暴："💥 [狂暴打击] 怒气爆发！造成 X 点毁灭性伤害！"

#### 🔮 法师学派（Mage）
**特色：元素法师**
- **魔法系统**：初始魔法值100
- **魔法攻击**：消耗20 MP，造成1.5倍伤害
- **魔力耗尽**：MP不足时用法杖攻击（0.5倍伤害）
- **魔力恢复**：每回合结束恢复10 MP
- **攻击文案**：
  - 有魔："✨ [法师] 释放火球术，造成 X 点魔法伤害！"
  - 无魔："[法师] 魔力耗尽，用法杖敲击，造成 X 点伤害..."

#### 🏹 游侠学派（Archer）
**特色：精准射手**
- **箭矢系统**：初始箭矢10支
- **精准射击**：消耗1支箭矢，造成正常伤害
- **连珠箭**：30%几率连射，造成双倍伤害（仍然只消耗1支箭）
- **箭矢耗尽**：使用匕首近战（0.3倍伤害）
- **攻击文案**：
  - 普通："🏹 [游侠] 精准射击，造成 X 点伤害！"
  - 连射："🎯 [连珠箭] 快速连射！造成 X 点伤害！"
  - 无箭："[游侠] 箭矢用尽，匕首攻击，造成 X 点伤害..."

#### 🗡️ 刺客学派（Assassin）- 挑战任务
**特色：暗影杀手**
- **能量系统**：初始能量50，每回合恢复15
- **普通攻击**：50%几率暴击（2倍伤害）
- **暗影暗杀**：消耗30能量，必定暴击（5倍伤害）
- **攻击文案**：
  - 普通："🗡️ [刺客] 利刃攻击，造成 X 点伤害！"
  - 暴击："⚡ [暴击] 致命一击！造成 X 点伤害！"
  - 暗杀："💀 [暗影暗杀] 从阴影中突袭！造成 X 点致命伤害！！！"

---

## 📋 任务清单

### 任务一：设计基类 Character（20分）

**要求：**
1. 定义protected成员变量：
   - `string name` - 角色名字
   - `int hp` - 当前生命值
   - `int maxHp` - 最大生命值
   - `int attackPower` - 基础攻击力
   - `string school` - 学派名称

2. 实现public方法：
   - `Character(string name, int hp, int attack, string school)` - 构造函数
   - `virtual void attack(Character* target) = 0` - 纯虚函数，攻击方法
   - `void takeDamage(int damage)` - 受伤方法
   - `bool isAlive()` - 判断是否存活
   - `void showStatus()` - 显示状态（带生命值进度条）
   - `virtual void showSkillInfo()` - 显示技能信息
   - `virtual ~Character()` - 虚析构函数

**提示：**
- 生命值进度条格式：`[████████░░] 80/100`
- `takeDamage()` 要确保 hp 不会低于 0

---

### 任务二：实现 Warrior 类（15分）

**要求：**
1. 继承 Character 类
2. 新增成员变量：`int rage` - 怒气值（初始为0）
3. 重写 `attack()` 方法：
   - 判断怒气是否满100
   - 满100：造成 `attackPower * 3` 伤害，清空怒气
   - 未满：造成 `attackPower` 伤害，怒气 +20
4. 重写 `showSkillInfo()` 方法

**示例输出：**
```
[战士] 挥舞巨剑，造成 50 点物理伤害！
怒气值: 40/100

💥 [狂暴打击] 怒气爆发！造成 150 点毁灭性伤害！
```

---

### 任务三：实现 Mage 类（15分）

**要求：**
1. 继承 Character 类
2. 新增成员变量：
   - `int mp` - 当前魔法值（初始100）
   - `int maxMp` - 最大魔法值（100）
3. 重写 `attack()` 方法：
   - MP >= 20：消耗20 MP，造成 `attackPower * 1.5` 伤害
   - MP < 20：造成 `attackPower * 0.5` 伤害
4. 新增方法：`void restoreMana()` - 恢复10 MP（回合结束调用）

---

### 任务四：实现 Archer 类（15分）

**要求：**
1. 继承 Character 类
2. 新增成员变量：`int arrows` - 箭矢数量（初始10）
3. 重写 `attack()` 方法：
   - 有箭矢：消耗1支，30%几率触发连射（双倍伤害）
   - 无箭矢：匕首攻击，造成 `attackPower * 0.3` 伤害
4. 使用 `rand() % 100 < 30` 判断连射

---

### 任务五：实现 Assassin 类（10分）- 挑战

**要求：**
1. 继承 Character 类
2. 新增成员变量：
   - `int energy` - 能量值（初始50）
   - `bool stealthMode` - 隐身状态
3. 重写 `attack()` 方法：
   - 能量>=30 且未隐身：可选择隐身（下次必暴击5倍）
   - 隐身状态：造成 `attackPower * 5` 伤害，解除隐身
   - 普通状态：50%几率暴击（2倍伤害）
4. 新增方法：`void restoreEnergy()` - 恢复15能量

---

### 任务六：实现 Arena 竞技场类（15分）

**要求：**
1. 实现 `void battle(Character* fighter1, Character* fighter2)` 方法
2. 战斗流程：
   ```
   1. 显示战斗开始信息
   2. 显示双方初始状态
   3. 回合制战斗循环：
      a. 显示回合数
      b. fighter1 攻击 fighter2
      c. 显示双方状态
      d. 判断 fighter2 是否存活
      e. fighter2 反击（如果存活）
      f. 显示双方状态
      g. 判断胜负
      h. 回合结束处理（法师恢复MP等）
   4. 显示战斗结果
   ```
3. 使用多态调用 `attack()` 方法

**示例输出格式：**
```
╔══════════════════════════════╗
║       战斗开始！              ║
╠══════════════════════════════╣
║  勇士阿瑟 VS 法师梅林          ║
╚══════════════════════════════╝

======== 第 1 回合 ========
勇士阿瑟 发起攻击：
[战士] 挥舞巨剑，造成 50 点物理伤害！

--- 战况 ---
勇士阿瑟 [████████░░] 100/100 HP
法师梅林 [██████░░░░] 50/100 HP
```

---

### 任务七：主函数测试（10分）

**要求：**
1. 创建至少4个不同角色
2. 进行至少3场战斗：
   - 战士 vs 法师
   - 游侠 vs 刺客
   - 获胜者 vs 另一场获胜者
3. 使用基类指针存储角色（体现多态）
4. 正确释放内存

**示例代码框架：**
```cpp
int main() {
    srand(time(0));

    // 创建角色
    Character* warrior = new Warrior("勇士阿瑟", 120, 50);
    Character* mage = new Mage("法师梅林", 80, 60);
    // ... 更多角色

    // 创建竞技场
    Arena arena;

    // 战斗1
    cout << "\n【第一场战斗】" << endl;
    arena.battle(warrior, mage);

    // 战斗2
    // ...

    // 释放内存
    delete warrior;
    delete mage;
    // ...

    return 0;
}
```

---

## 💡 实现提示

### 生命值进度条实现
```cpp
void showStatus() {
    cout << name << " [";

    int barLength = 10;
    int filled = (hp * barLength) / maxHp;

    for (int i = 0; i < barLength; i++) {
        if (i < filled) {
            cout << "█";
        } else {
            cout << "░";
        }
    }

    cout << "] " << hp << "/" << maxHp << " HP" << endl;
}
```

### 随机数判断
```cpp
// 30% 几率触发
if (rand() % 100 < 30) {
    // 触发连射
}
```

### 多态使用
```cpp
// Arena 类中
void battle(Character* f1, Character* f2) {
    f1->attack(f2);  // 自动调用正确的版本
}
```

---

## ✅ 知识点检查表

完成项目后，确保你理解了以下概念：

- [ ] 继承语法：`class Derived : public Base`
- [ ] 构造函数继承：`: Base(args)`
- [ ] 虚函数：`virtual void func()`
- [ ] 纯虚函数：`virtual void func() = 0`
- [ ] 方法重写：子类重新实现虚函数
- [ ] 多态调用：基类指针调用子类方法
- [ ] 虚析构函数：`virtual ~Base()`
- [ ] protected 访问控制
- [ ] 抽象类的概念
- [ ] 动态内存管理：new/delete

---

## 🎯 评分标准

| 项目 | 分值 | 评分要点 |
|------|------|---------|
| Character 基类 | 20分 | 完整实现所有方法，正确使用纯虚函数 |
| Warrior 实现 | 15分 | 怒气系统正确，攻击逻辑完整 |
| Mage 实现 | 15分 | 魔法系统正确，MP恢复机制 |
| Archer 实现 | 15分 | 箭矢系统和连射机制正确 |
| Assassin 实现 | 10分 | 能量和暗杀机制正确 |
| Arena 实现 | 15分 | 战斗流程完整，多态使用正确 |
| 主函数测试 | 10分 | 测试完整，正确释放内存 |
| **总分** | **100分** | |

**加分项（最多+10分）：**
- [ ] 输出格式美观（使用边框、颜色等）
- [ ] 添加战斗统计（回合数、总伤害等）
- [ ] 实现额外功能（治疗、防御等）
- [ ] 代码注释清晰完整

---

## 📦 提交内容

1. 完整的 `.cpp` 源代码文件
2. 编译命令和运行截图
3. 简短的项目总结（200字以内）

**编译命令：**
```bash
g++ -std=c++11 你的文件名.cpp -o battle
./battle
```

---

## 🌟 扩展挑战（可选）

如果你完成了基础任务，可以尝试：

1. **多人乱斗模式**：3个或更多角色同时战斗
2. **技能冷却系统**：大招使用后需要等待几回合
3. **装备系统**：角色可以装备武器提升属性
4. **AI 对战**：实现简单的 AI 策略
5. **战斗回放**：记录战斗过程并回放

---

## 🆘 常见问题

**Q: 纯虚函数和虚函数有什么区别？**
A: 纯虚函数用 `= 0` 声明，没有实现，包含纯虚函数的类是抽象类，不能实例化。虚函数可以有默认实现。

**Q: 为什么需要虚析构函数？**
A: 当使用基类指针删除派生类对象时，如果析构函数不是虚函数，只会调用基类的析构函数，导致派生类的资源无法释放。

**Q: 怎么判断多态是否生效？**
A: 通过基类指针调用虚函数时，如果执行的是派生类的版本，说明多态生效。

**Q: rand() 的随机数不够随机怎么办？**
A: 在 main 函数开头添加 `srand(time(0));` 初始化随机数种子。

---

## 📚 参考资料

- 课件：面向对象-类和对象
- 课件：面向对象-继承和多态
- 代码：综合实践-学生版.cpp

---

> 💪 **加油！** 这是一个完整的项目，认真完成后你会对继承和多态有深刻的理解！
>
> 🎓 如有问题，随时向老师请教。祝你编程愉快！